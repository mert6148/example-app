/**
 * Bundle.min.js - Tüm uygulamalar için entegre kütüphaneler
 * Çeşitli genel işlevleri içeren utility kütüphanesi
 */

/**
 * Olay yöneticisi
 */
export class EventManager {
    constructor() {
        this.listeners = new Map();
    }

    on(eventName, callback) {
        if (!this.listeners.has(eventName)) {
            this.listeners.set(eventName, []);
        }
        this.listeners.get(eventName).push(callback);
    }

    off(eventName, callback) {
        if (this.listeners.has(eventName)) {
            const listeners = this.listeners.get(eventName);
            const index = listeners.indexOf(callback);
            if (index > -1) listeners.splice(index, 1);
        }
    }

    emit(eventName, data) {
        if (this.listeners.has(eventName)) {
            this.listeners.get(eventName).forEach(cb => cb(data));
        }
    }
}

/**
 * LocalStorage Yöneticisi
 */
export class StorageManager {
    constructor(prefix = 'app_') {
        this.prefix = prefix;
    }

    set(key, value) {
        localStorage.setItem(this.prefix + key, JSON.stringify(value));
    }

    get(key) {
        const item = localStorage.getItem(this.prefix + key);
        return item ? JSON.parse(item) : null;
    }

    remove(key) {
        localStorage.removeItem(this.prefix + key);
    }

    clear() {
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith(this.prefix)) {
                localStorage.removeItem(key);
            }
        });
    }
}

/**
 * HTTP İstek Yöneticisi
 */
export class HttpClient {
    constructor(baseURL = '') {
        this.baseURL = baseURL;
    }

    async request(method, url, data = null, headers = {}) {
        const fullUrl = this.baseURL + url;
        const options = {
            method,
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
                ...headers
            }
        };

        if (data) {
            options.body = JSON.stringify(data);
        }

        try {
            const response = await fetch(fullUrl, options);
            const result = await response.json();
            return { success: response.ok, data: result, status: response.status };
        } catch (error) {
            return { success: false, error: error.message, status: 0 };
        }
    }

    get(url, headers) {
        return this.request('GET', url, null, headers);
    }

    post(url, data, headers) {
        return this.request('POST', url, data, headers);
    }

    put(url, data, headers) {
        return this.request('PUT', url, data, headers);
    }

    delete(url, headers) {
        return this.request('DELETE', url, null, headers);
    }
}

/**
 * DOM Yardımcı İşlevler
 */
export class DOM {
    static query(selector) {
        return document.querySelector(selector);
    }

    static queryAll(selector) {
        return document.querySelectorAll(selector);
    }

    static create(tagName, className = '', textContent = '') {
        const el = document.createElement(tagName);
        if (className) el.className = className;
        if (textContent) el.textContent = textContent;
        return el;
    }

    static addClass(el, className) {
        el.classList.add(className);
    }

    static removeClass(el, className) {
        el.classList.remove(className);
    }

    static toggleClass(el, className) {
        el.classList.toggle(className);
    }

    static hasClass(el, className) {
        return el.classList.contains(className);
    }

    static on(el, event, handler) {
        el.addEventListener(event, handler);
    }

    static off(el, event, handler) {
        el.removeEventListener(event, handler);
    }

    static show(el) {
        el.style.display = '';
    }

    static hide(el) {
        el.style.display = 'none';
    }

    static html(el, content) {
        if (content !== undefined) {
            el.innerHTML = content;
        }
        return el.innerHTML;
    }

    static text(el, content) {
        if (content !== undefined) {
            el.textContent = content;
        }
        return el.textContent;
    }

    static attr(el, name, value) {
        if (value !== undefined) {
            el.setAttribute(name, value);
        }
        return el.getAttribute(name);
    }
}

/**
 * Zamanla İşlevleri
 */
export class Timer {
    static debounce(func, delay) {
        let timeoutId;
        return function(...args) {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => func(...args), delay);
        };
    }

    static throttle(func, delay) {
        let lastCall = 0;
        return function(...args) {
            const now = Date.now();
            if (now - lastCall >= delay) {
                lastCall = now;
                func(...args);
            }
        };
    }

    static sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}

/**
 * Doğrulama İşlevleri
 */
export class Validator {
    static isEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    static isPhone(phone) {
        return /^[\d\s\-\+\(\)]{10,}$/.test(phone);
    }

    static isStrongPassword(password) {
        return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(password);
    }

    static isURL(url) {
        try {
            new URL(url);
            return true;
        } catch {
            return false;
        }
    }

    static isEmpty(value) {
        return value === null || value === undefined || value === '' || (Array.isArray(value) && value.length === 0);
    }
}

/**
 * Toast Bildirimleri
 */
export class Toast {
    static show(message, type = 'info', duration = 3000) {
        const toastContainer = document.getElementById('toast-container') || this.createContainer();

        const toast = DOM.create('div', `toast toast-${type}`, message);
        toast.style.cssText = `
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 4px;
            background-color: ${this.getColor(type)};
            color: white;
            animation: slideInRight 0.3s ease-in-out;
        `;

        toastContainer.appendChild(toast);

        if (duration > 0) {
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease-in-out';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        return toast;
    }

    static createContainer() {
        const container = DOM.create('div', 'toast-container');
        container.id = 'toast-container';
        container.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            width: 300px;
        `;
        document.body.appendChild(container);
        return container;
    }

    static getColor(type) {
        const colors = {
            success: '#28a745',
            error: '#dc3545',
            warning: '#ffc107',
            info: '#17a2b8'
        };
        return colors[type] || colors.info;
    }

    static success(message, duration = 3000) {
        return this.show(message, 'success', duration);
    }

    static error(message, duration = 3000) {
        return this.show(message, 'error', duration);
    }

    static warning(message, duration = 3000) {
        return this.show(message, 'warning', duration);
    }

    static info(message, duration = 3000) {
        return this.show(message, 'info', duration);
    }
}

/**
 * Başlatma Fonksiyonu
 */
export function init() {
    console.log('✓ Bundle.min.js yüklendi');

    // Global scope'a ekle
    window.EventManager = EventManager;
    window.StorageManager = StorageManager;
    window.HttpClient = HttpClient;
    window.DOM = DOM;
    window.Timer = Timer;
    window.Validator = Validator;
    window.Toast = Toast;
}

// Otomatik başlat
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}
